<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Location-based AR.js</title>
    <!-- include aframe -->
    <script src="https://aframe.io/releases/1.0.4/aframe.js"></script>
    <!-- include ar.js -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script>
      const log = console.log;
      window.onload = () => {
        let scene = document.querySelector('a-scene'); /* Apply to whole scene */

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
            let gps = document.createAttribute('gps-entity-place');
            let arjs = document.createAttribute('arjs');
            arjs.value = 'sourceType: webcam; sourceWidth: 1280; sourceHeight: 960; trackingMethod: best; debugUIEnabled: false;';
            gps.value = `latitude: ${position.coords.latitude - 0.001}; longitude: ${position.coords.longitude + 0.001}`;
            log(gps.value);
            scene.setAttributeNode(gps); /* Apply to whole scene */
            scene.setAttributeNode(arjs);
          });
        }

      };
      
      AFRAME.registerComponent('arrow', {

        init: function(){
          var rotation = "0 0 0";
          this.el.setAttribute('rotation', rotation)
        }

      });

      AFRAME.registerComponent('distance', {

        init: function(){
          var distance = 10;
          this.el.setAttribute('value', distance + " m")
        }

      });	
    </script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div style='position: fixed; top: 10px; width:100%; text-align: center; z-index: 1;'>
      <button onclick="turnSharpLeft()"><<<</button>
      <button onclick="turnLeft()"><<</button>
      <button onclick="turnSlightLeft()"><</button>
      <button onclick="continueOnStreet()">^</button>
      <button onclick="turnSlightRight()">></button>
      <button onclick="turnRight()">>></button>
      <button onclick="turnSharpRight()">>>></button>
    </div>	
  
    <a-scene vr-mode-ui="enabled: false">
      <a-assets>
        <a-asset-item id="arrow-obj" src="arrow-obj/nnf-arrow.obj"></a-asset-item>
        <a-asset-item id="arrow-mtl" src="arrow-obj/nnf-arrow.mtl"></a-asset-item>
      </a-assets>
      <a-entity id="mouseCursor" cursor="rayOrigin: mouse" raycaster="objects: .intersectable; useWorldCoordinates: true;"></a-entity>
      <a-entity id="wrapper" position="0 -8 0" emitevents="true">
        <a-entity arrow id="arrow" class="intersectable" obj-model="obj: #arrow-obj; mtl: #arrow-mtl" position="0 0 -10" scale="5 5 5" rotation="0 0 0"></a-entity>
        <a-text distance id="distance" class="intersectable" value="0 m" color="blue" scale="75 75 75" position="0 0 -150" align="center"></a-text>
        <!-- look-at="[gps-camera]" -->
      </a-entity>
      <a-camera gps-camera rotation-reader> </a-camera>
    </a-scene>
    <script>	
      function turnSlightRight() {
          var x = "0 -30 0";
          localStorage.setItem('rotation', x);  
          document.querySelector('[arrow]').components.arrow.el.setAttribute('rotation', x);
      }

      function turnRight() {
          var x = "0 -60 0";
          localStorage.setItem('rotation', x)  
          document.querySelector('[arrow]').components.arrow.el.setAttribute('rotation', x);
      }

      function turnSharpRight() {
          var x = "0 -90 0";
          localStorage.setItem('rotation', x)  
          document.querySelector('[arrow]').components.arrow.el.setAttribute('rotation', x);
      }

      function continueOnStreet() {
          var x = "0 0 0";
          localStorage.setItem('rotation', x)  
          document.querySelector('[arrow]').components.arrow.el.setAttribute('rotation', x);
      }

      function turnSharpLeft() {
          var x = "0 -90 0";
          localStorage.setItem('rotation', x);  
          document.querySelector('[arrow]').components.arrow.el.setAttribute('rotation', x);
      }

      function turnLeft() {
          var x = "0 -60 0";
          localStorage.setItem('rotation', x)  
          document.querySelector('[arrow]').components.arrow.el.setAttribute('rotation', x);
      }

      function turnSlightLeft() {
          var x = "0 -30 0";
          localStorage.setItem('rotation', x)  
          document.querySelector('[arrow]').components.arrow.el.setAttribute('rotation', x);
      }  	
    </script>    
  </body>
</html>
